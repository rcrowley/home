<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
	"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
  <title></title>

  <link rel="stylesheet" href="./css/reset.css" type="text/css"/>
  <link rel="stylesheet" href="./css/showoff.css" type="text/css"/>

  <script type="text/javascript" src="./js/jquery-1.4.2.min.js"></script>
  <script type="text/javascript" src="./js/jquery.cycle.all.js"></script>
	<script type="text/javascript" src="./js/jquery-print.js"></script>
  <script type="text/javascript" src="./js/jquery.batchImageLoad.js"></script>

  <script type="text/javascript" src="./js/jquery.doubletap-0.1.js"></script>

  <script type="text/javascript" src="./js/fg.menu.js"></script>
  <script type="text/javascript" src="./js/showoff.js"></script>
  <script type="text/javascript" src="./js/jTypeWriter.js"> </script>
  <script type="text/javascript" src="./js/sh_main.min.js"></script>
  <script type="text/javascript" src="./js/core.js"></script>
  <script type="text/javascript" src="./js/showoffcore.js"></script>

  <link type="text/css" href="./css/fg.menu.css" media="screen" rel="stylesheet" />
  <link type="text/css" href="./css/theme/ui.all.css" media="screen" rel="stylesheet" />
  <link type="text/css" href="./css/sh_style.css" rel="stylesheet" >

  
    <link rel="stylesheet" href="file/helfuckingvetica.css" type="text/css"/>
  

  
    <script type="text/javascript" src="file/sh_ruby.js"></script>
  
    <script type="text/javascript" src="file/sh_puppet.js"></script>
  
    <script type="text/javascript" src="file/centerdammit.js"></script>
  

  <script type="text/javascript">
  $(function(){
    setupPreso(false, './');
  });
  </script>
</head>

<body>


<a tabindex="0" href="#search-engines" class="fg-button fg-button-icon-right ui-widget ui-state-default ui-corner-all" id="navmenu"><span class="ui-icon ui-icon-triangle-1-s"></span>slides</a>
<div id="navigation" class="hidden"></div>

<div id="help">
  <table>
    <tr><td class="key">space, &rarr;</td><td>next slide</td></tr>
    <tr><td class="key">&larr;</td><td>previous slide</td></tr>
    <tr><td class="key">d</td><td>debug mode</td></tr>
    <tr><td class="key">## &lt;ret&gt;</td><td>go to slide #</td></tr>
    <tr><td class="key">c</td><td>table of contents (vi)</td></tr>
    <tr><td class="key">f</td><td>toggle footer</td></tr>
    <tr><td class="key">r</td><td>reload slides</td></tr>
    <tr><td class="key">z</td><td>toggle help (this)</td></tr>
  </table>
</div>

<div class="buttonNav">
  <input type="submit" onClick="prevStep();" value="prev"/>
  <input type="submit" onClick="nextStep();" value="next"/>
</div>

<div id="preso">loading presentation...</div>
<div id="footer">
  <span id="slideInfo"></span>
  <span id="debugInfo"></span>
  <span id="notesInfo"></span>
</div>

<div id="slides" class="offscreen" style="display:none;">
<div class="slide" data-transition="none"><div class="content bullets" ref="./slides/1">
<h1>Blueprint</h1>

<h2>Configuration management for busy people</h2>

<ul>
<li><a href="http://rcrowley.org/talks/rubyconf-2011/">rcrowley.org/talks/rubyconf-2011/</a></li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content bullets" ref="./slides/2">
<h1>Hi, I&#x2019;m Richard Crowley</h1>

<ul>
<li>Equal opportunity technology hater.</li>
<li>DevStructure&#x2019;s operator and UNIX hacker.</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content bullets" ref="./slides/3">
<h1>Blueprint</h1>

<ul>
<li><a href="https://github.com/devstructure/blueprint">github.com/devstructure/blueprint</a></li>
<li>Debian- or RPM-based Linux.</li>
<li>Python 2.6 or better.</li>
<li>BSD licensed.</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content bullets" ref="./slides/4">
<h1>Blueprint</h1>

<ul>
<li>Figures out what you did.</li>
<li>Puts it in JSON in Git.</li>
<li>Generates code.</li>
<li>Deploys it.</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content bullets" ref="./slides/5">
<h1>Philosophy</h1></div>
</div><div class="slide" data-transition="none"><div class="content bullets" ref="./slides/6">
<h1>Philosophy</h1>

<h2>Realistic development environments</h2>

<ul>
<li>Linux.</li>
<li>Real web servers and databases.</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content bullets" ref="./slides/7">
<h1>Philosophy</h1>

<h2>Familiar interactive tools</h2>

<ul>
<li><code>apt-get install gcc</code></li>
<li>Not <code>package { "gcc": ensure =&gt; installed }</code></li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content bullets" ref="./slides/8">
<h1>Philosophy</h1>

<h2>Whole-stack configuration management</h2>

<ul>
<li>APT, Yum, RubyGems, PyPI, PEAR, NPM.</li>
<li><code>/etc</code> and <code>/usr/local</code>.</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content bullets" ref="./slides/9">
<h1>Philosophy</h1>

<h2>Idempotent everything</h2>

<ul>
<li>No diffing/patching.</li>
<li>&#x201C;Compliance.&#x201D;</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content bullets" ref="./slides/10">
<h1>Philosophy</h1>

<h2>Gently encourage The Right Way</h2>

<ul>
<li>The UNIX Way.</li>
<li>The Debian Way or The RedHat Way.</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content bullets" ref="./slides/11">
<h1>Philosophy</h1>

<h2>Never having to say you&#x2019;re sorry</h2>

<ul>
<li>Reverse-engineer absolute state.</li>
<li>It doesn&#x2019;t matter when you install Blueprint.</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content bullets" ref="./slides/12">
<h1>Philosophy</h1>

<h2>Simple file formats</h2>

<ul>
<li>JSON.</li>
<li>Tarballs.</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content bullets" ref="./slides/13">
<h1>Philosophy</h1>

<h2>UNIX man pages</h2>

<ul>
<li><a href="http://devstructure.github.com/blueprint/blueprint-create.1.html"><code>blueprint-create</code>(1)</a></li>
<li><a href="http://devstructure.github.com/blueprint/blueprint.5.html"><code>blueprint</code>(5)</a></li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content bullets" ref="./slides/14">
<h1>Philosophy</h1>

<h2>Interoperability</h2>

<ul>
<li>Puppet and Chef.</li>
<li>EC2 via user-data.</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content bullets" ref="./slides/15">
<h1>Workflow</h1></div>
</div><div class="slide" data-transition="none"><div class="content bullets" ref="./slides/16">
<h1>Workflow</h1>

<h2>Start with your production OS</h2>

<ul>
<li>Vagrant, raw VirtualBox, or the cloud.</li>
<li>You have <code>root</code> access, so use it.</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content bullets smaller" ref="./slides/17">


<pre><strong>$</strong> echo "deb http://packages.devstructure.com lucid main" |
  sudo tee /etc/apt/sources.list.d/devstructure.list
<strong>$</strong> sudo wget -O /etc/apt/trusted.gpg.d/devstructure.gpg \
  http://packages.devstructure.com/keyring.gpg
<strong>$</strong> sudo apt-get update
...
<strong>$</strong> sudo apt-get -y install blueprint
...
<strong>$</strong> blueprint
Usage: blueprint &lt;command&gt; [...]
Common commands: list, create, show, diff, apply, destroy, git
<strong>$</strong></pre>
</div>
</div><div class="slide" data-transition="none"><div class="content bullets" ref="./slides/18">
<h1>Workflow</h1>

<h2>RubyGems</h2>

<ul>
<li><code>sudo gem install mysql2</code></li>
<li>Good idea.</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content bullets" ref="./slides/19">
<h1>Workflow</h1>

<h2>RubyGems</h2>

<ul>
<li><code>bundle install --path vendor/bundle</code></li>
<li>Bad idea.</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content bullets" ref="./slides/20">
<h1>Workflow</h1>

<h2>RubyGems</h2>

<ul>
<li><code>bundle install --system</code></li>
<li>If you must.</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content bullets" ref="./slides/21">
<h1>Workflow</h1>

<h2>Ruby itself</h2>

<ul>
<li><del><code>rvm</code></del>, <del><code>rbenv</code></del>, <code>fpm</code></li>
<li><a href="http://bit.ly/jtimberman-ruby-fpm">bit.ly/jtimberman-ruby-fpm</a></li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content bullets smaller" ref="./slides/22">


<pre class="sh_Sh sh_sourceCode">
wget ftp://ftp.ruby-lang.org//pub/ruby/1.9/ruby-1.9.2-p180.tar.gz
tar -zxvf ruby-1.9.2-p180.tar.gz
cd src/ruby-1.9.2-p180
./configure --prefix=/usr 
make 
make install DESTDIR=/tmp/installdir

fpm -s dir -t deb -n ruby -v 1.9.2-p180 -C /tmp/installdir \
    -p ruby-VERSION_ARCH.deb -d "libstdc++6 (&gt;= 4.4.3)" \
    -d "libc6 (&gt;= 2.6)" -d "libffi5 (&gt;= 3.0.4)" \
    -d "libgdbm3 (&gt;= 1.8.3)" -d "libncurses5 (&gt;= 5.7)" \
    -d "libreadline6 (&gt;= 6.1)" -d "libssl0.9.8 (&gt;= 0.9.8)" \
    -d "zlib1g (&gt;= 1:1.2.2)" \
    usr/bin usr/lib usr/share/man usr/include
</pre>
</div>
</div><div class="slide" data-transition="none"><div class="content bullets" ref="./slides/23">
<h1>Workflow</h1>

<h2>Ruby itself</h2>

<ul>
<li>Put it in your own Debian archive.</li>
<li><a href="https://github.com/rcrowley/freight">github.com/rcrowley/freight</a></li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content bullets" ref="./slides/24">
<h1>Workflow</h1>

<h2>Blueprints</h2>

<ul>
<li><code>blueprint create foo</code></li>
<li>Reverse-engineers the server.</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content bullets small" ref="./slides/25">


<pre><strong>$</strong> sudo blueprint create foo
# [blueprint] searching for APT packages to exclude
# [blueprint] caching excluded APT packages
# [blueprint] searching for Yum packages to exclude
# [blueprint] parsing ~/.blueprintignore
# [blueprint] searching for Yum packages
# [blueprint] searching for APT packages
# [blueprint] searching for Python packages
# [blueprint] searching for PEAR/PECL packages
# [blueprint] searching for Ruby gems
# [blueprint] searching for configuration files
# [blueprint] searching for software built from source
# [blueprint] searching for service dependencies
<strong>$</strong></pre>
</div>
</div><div class="slide" data-transition="none"><div class="content bullets" ref="./slides/26">
<h1>Workflow</h1>

<h2>Packages</h2>

<ul>
<li>APT, Yum, RubyGems, PyPI, PEAR, NPM.</li>
<li>Ignores the &#x201C;base system&#x201D; by default.</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content bullets" ref="./slides/27">
<h1>Workflow</h1>

<h2>Files</h2>

<ul>
<li>Configuration files from <code>/etc</code>.</li>
<li>Ignores unchanged files from packages.</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content bullets" ref="./slides/28">
<h1>Workflow</h1>

<h2>Source installs</h2>

<ul>
<li><code>./configure &amp;&amp; make &amp;&amp; make install</code></li>
<li>Junk drawer.</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content bullets" ref="./slides/29">
<h1>Workflow</h1>

<h2>Services</h2>

<ul>
<li>System V init and Upstart.  Runit soon.</li>
<li>When should each service be restarted?</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content bullets" ref="./slides/30">
<h1>Workflow</h1>

<h2>Inspecting blueprints</h2>

<ul>
<li><code>blueprint show foo | less</code></li>
<li>Show the JSON representation.</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content bullets smaller" ref="./slides/31">


<pre>{
 "files": {
  "/etc/apt/sources.list.d/devstructure.list": {
   "content": "deb http://packages.devstructure.com natty main\n",
   "encoding": "plain",
   "group": "root",
   "mode": "100644",
   "owner": "root"
  }
 },
 "packages": {
  "apt": {
   "openssh-server": ["1:5.8p1-1ubuntu3"],
  }
 },
 "services": {
  "sysvinit": {
   "ssh": {
    "packages": {
     "apt": ["openssh-server"]
    }
   }
  }
 }
}</pre>
</div>
</div><div class="slide" data-transition="none"><div class="content bullets smaller" ref="./slides/32">


<pre>{
 "packages": {
  "apt": {
   "libc6-dev": ["2.13-0ubuntu13"],
   "libruby1.8": ["1.8.7.302-2"],
   "libruby1.8-dev": ["1.8.7.302-2"],
   "ruby1.8": ["1.8.7.302-2"],
   "ruby1.8-dev": ["1.8.7.302-2"],
   "ruby": ["4.5"],
   "ruby-dev": ["4.5"],
   "rubygems1.8": ["1.3.7-3"]
  },
  "rubygems1.8": {
   "mysql2": ["0.3.7"],
   "rack": ["1.3.3"],
   "sinatra": ["1.2.1", "1.2.6"],
   "tilt": ["1.3.3"]
  }
 },
 "sources": {
  "/usr/local": "0b53de6a4fd7fcc3d029a7c08c0279842c1f1cb3.tar"
 }
}</pre>
</div>
</div><div class="slide" data-transition="none"><div class="content bullets" ref="./slides/33">
<h1>Workflow</h1>

<h2>Inspecting blueprints</h2>

<ul>
<li><code>blueprint show-packages foo</code></li>
<li>Pipeline-friendly format.</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content bullets" ref="./slides/34">


<pre>
apt libc6-dev 2.13-0ubuntu13
apt libruby1.8 1.8.7.302-2
apt libruby1.8-dev 1.8.7.302-2
apt ruby1.8 1.8.7.302-2
apt ruby1.8-dev 1.8.7.302-2
apt ruby 4.5
apt ruby-dev 4.5
apt rubygems1.8 1.3.7-3
rubygems1.8 mysql2 0.3.7
rubygems1.8 rack 1.3.3
rubygems1.8 sinatra 1.2.1
rubygems1.8 sinatra 1.2.6
rubygems1.8 tilt 1.3.3
</pre>
</div>
</div><div class="slide" data-transition="none"><div class="content bullets" ref="./slides/35">
<h1>Workflow</h1>

<h2>Inspecting blueprints</h2>

<ul>
<li><code>blueprint show-sources foo</code></li>
<li>Just like <code>tar tv</code> output.</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content bullets smaller" ref="./slides/36">


<pre>
/usr/local 0b53de6a4fd7fcc3d029a7c08c0279842c1f1cb3.tar
drwxr-xr-x root/root         0 2011-08-10 23:20 ./
drwxr-xr-x root/root         0 2011-08-10 21:29 ./share/
-rw-r--r-- root/root        84 2011-08-10 22:48 ./share/foobar
</pre>
</div>
</div><div class="slide" data-transition="none"><div class="content bullets" ref="./slides/37">
<h1>Workflow</h1>

<h2>Blueprint diet plan</h2>

<ul>
<li><code>~/.blueprintignore</code></li>
<li>Inspired by <code>gitignore</code>(5).</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content bullets" ref="./slides/38">


<pre>
/etc/apt
!/etc/apt/sources.list.d
!/etc/apt/trusted.gpg.d
*.pyc
/etc/hosts
/etc/nginx/sites-enabled/default
/etc/sudoers

:package:apt/build-essential
!:package:apt/build-essential
:package:apt/libopts25
:package:apt/libtspi1
:package:rubygems1.8/tilt

:source:/usr/local/share/foobar
!:source:/opt
</pre>
</div>
</div><div class="slide" data-transition="none"><div class="content bullets" ref="./slides/39">
<h1>Workflow</h1>

<h2>Push and pull</h2>

<ul>
<li><code>blueprint push foo</code></li>
<li><code>blueprint pull foo</code></li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content bullets smaller" ref="./slides/40">


<pre><strong>$</strong> blueprint push foo
# [blueprint] completed - blueprint URL:
https://devstructure.com/0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcd
efghijklmnopqrstuvwxyz_-/foo
<strong>$</strong> blueprint pull https://devstructure.com/0123456789ABCDEFGHIJKLM
NOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz_-/foo
# [blueprint] completed - blueprint stored locally and ready for
use
<strong>$</strong></pre>
</div>
</div><div class="slide" data-transition="none"><div class="content bullets" ref="./slides/41">
<h1>Workflow</h1>

<h2>Push and pull</h2>

<ul>
<li>Unguessable URLs.</li>
<li>Stored in S3.</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content bullets" ref="./slides/42">
<h1>Workflow</h1>

<h2>Bootstrap new environments</h2>

<ul>
<li><code>blueprint apply foo</code></li>
<li>New guy&#x2019;s devbox?  No problem.</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content bullets" ref="./slides/43">
<h1>Deployment</h1></div>
</div><div class="slide" data-transition="none"><div class="content bullets" ref="./slides/44">
<h1>Deployment</h1>

<h2>Generate shell code</h2>

<ul>
<li><code>blueprint show -S foo</code></li>
<li>Run <code>foo.sh</code> without installing Blueprint.</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content bullets smaller" ref="./slides/45">


<pre class="sh_Sh sh_sourceCode">
mkdir -p "/etc/apt/sources.list.d"
cat &gt;"/etc/apt/sources.list.d/devstructure.list" &lt;&lt;EOF
deb http://packages.devstructure.com natty main
EOF
export APT_LISTBUGS_FRONTEND="none"
export APT_LISTCHANGES_FRONTEND="none"
export DEBIAN_FRONTEND="noninteractive"
apt-get -q update
[ "$(dpkg-query -f'${Version}\n' -W openssh-server)" \
    = "1:5.8p1-1ubuntu3" ] || {
    apt-get -y -q -o DPkg::Options::=--force-confold install \
        openssh-server=1:5.8p1-1ubuntu3
    SERVICE_sysvinit_ssh=1
}
[ -n "$SERVICE_sysvinit_ssh" ] &amp;&amp; /etc/init.d/ssh restart
</pre>
</div>
</div><div class="slide" data-transition="none"><div class="content bullets" ref="./slides/46">
<h1>Deployment</h1>

<h2>Puppet and Chef can play, too</h2>

<ul>
<li><code>blueprint show -P foo</code></li>
<li><code>blueprint show -C foo</code></li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content bullets smaller" ref="./slides/47">


<pre class="sh_Puppet sh_sourceCode">class foo {
    Class['files'] -&gt; Class['packages']
    class files {
        file {
            '/etc/apt/sources.list.d/devstructure.list':
                content =&gt; template('foo/etc/apt/sources.list.d/devstructure.list'),
                ensure  =&gt; file,
                group   =&gt; root,
                mode    =&gt; 0644,
                owner   =&gt; root;
        }
    }
    include files
    class packages {
        class apt {
            package {
                'openssh-server':
                    ensure =&gt; '1:5.8p1-1ubuntu3';
            }
        }
        include apt
    }
    include packages
    class services {
        class sysvinit {
            service { 'ssh':
                enable    =&gt; true,
                ensure    =&gt; running,
                subscribe =&gt; Package['openssh-server'],
            }
        }
        include sysvinit
    }
    include services
}</pre>
</div>
</div><div class="slide" data-transition="none"><div class="content bullets smaller" ref="./slides/48">


<pre class="sh_Ruby sh_sourceCode">cookbook_file('/etc/apt/sources.list.d/devstructure.list') do
  backup false
  group 'root'
  mode '0644'
  owner 'root'
  source 'etc/apt/sources.list.d/devstructure.list'
end
package('openssh-server') { version '1:5.8p1-1ubuntu3' }
service('ssh') do
  action [:enable, :start]
  subscribes :restart, resources('package[openssh-server]')
end</pre>
</div>
</div><div class="slide" data-transition="none"><div class="content bullets" ref="./slides/49">
<h1>Deployment</h1>

<h2>Remotely generated shell code</h2>

<ul>
<li>Fetch without installing Blueprint.</li>
<li>Plays nicely with <code>cron</code>(8).</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content bullets smaller" ref="./slides/50">


<pre>0 * * * * curl https://devstructure.com/<em>secret</em>/foo/foo.sh | sh</pre>
</div>
</div><div class="slide" data-transition="none"><div class="content bullets" ref="./slides/51">
<h1>Deployment</h1>

<h2>Bootstrap on EC2</h2>

<ul>
<li><code>user-data.sh</code></li>
<li><a href="https://github.com/devstructure/python-cloudformation"><code>python-cloudformation</code></a></li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content bullets small" ref="./slides/52">


<pre class="sh_Sh sh_sourceCode">#!/bin/sh

set -e

TMPDIR="$(mktemp -d)"
cd "$TMPDIR"
trap "rm -rf \"$TMPDIR\"" EXIT

wget "http://devstructure.com/<em>secret</em>/foo/foo.sh"

sh "$(ls)"</pre>
</div>
</div><div class="slide" data-transition="none"><div class="content bullets" ref="./slides/53">
<h1>Future work</h1>

<ul>
<li>Modularity and inheritance.</li>
<li>Service supervisors: Runit, Monit, <code>systemd</code>.</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content bullets" ref="./slides/54">
<h1>Thank you</h1>

<ul>
<li><a href="http://rcrowley.org/talks/rubyconf-2011/">rcrowley.org/talks/rubyconf-2011/</a></li>
<li><a href="mailto:richard@devstructure.com">richard@devstructure.com</a> or <a href="https://twitter.com/rcrowley">@rcrowley</a></li>
</ul>
</div>
</div></div>

</body>
</html>
